language: python
dist: focal 
sudo: false
notifications:
  email: false
addons:
  sonarcloud:
    organization: "unhaggle"
    token:
       secure: fupUGpi3SnAspzZUMJIA2r37vuVD6uw13mvyOxO1SSG2ZiHVDnew/1FFTqU1/7+3DlJno8Jw55O4Kvh/PBJ9XLn8dhjcp2iU3mO5lPR55ZIqrKDJsRKZkgJtA0kUKSxF6cdGh31xLF1RWSRUJSGm/VgUOoO4W32wmdr4QuUkwEFnPqS5sDXxlLE/yv80vRVZB+1k6B/KsSOWNOzLGAkgSOE4H0zzeZiwuI7srCKWya1Q5z8rhBiz+1f1ALVmWD5lcDR4+C88fJdIiyBLBaIMesx99Zg82TP+uIxKpKuDhkwbGukdJcbgQQBHxi+PNwd3eev77SOfzeKTThGAugNceIvGwTZIUiNkRsUnfiornPSt5DC6HLuA3Eyw8qPGw/PrfT9g02O7S7f8tAYIgNaUcXoMqM3X3b5zFKa1UulM7cF8ozpCDtoq5VvMO+GovsEnxsn+2n3zqEspzaQz39R1O8xZQM0sINPFSsuztKfL5JDwSbV2S3WbcF966IGM1s8q7QCEc/AyQR4iUehf3034cL5uzAKojM6z8lT+K1P3BOS826iwaBlpsbkHs+QwZgICnzxkZebk69I0zMNM6ufEe5u2SUMzd7f/0BhMK97FgYwMfQF0zOrJWnwG5o2ybVXOPdn1ZmwtjkjOn7RJCjpdBMXMx9tdpoYGHfWFQ5NjMFo=

branches:
  only:
    - master
cache:
  pip: true
services:
  - redis-server
python:
  - "3.6"
  - "3.7"
  - "3.8"
  - "3.10"
install:
  - pip install -U pip setuptools
  - pip install -r requirements.txt
script:
  - set -e
  - coverage run --source=cronman/ setup.py test
  - coverage xml
  - |
    if [ $(python -V 2>&1 | grep -Po '(?<=Python )(\d\.\d+)') == "3.10" ]; then
      sonar-scanner -Dsonar.projectVersion=$(python ./setup.py --version)
    fi
